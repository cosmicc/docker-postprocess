#!/usr/bin/env python3

from pathlib import Path
import subprocess
from loguru import logger as log
from sys import exit
from time import sleep

process_path = Path('/mnt/downloads/process')


while True:
    for file in process_path.iterdir():
        if file.suffix != '.ignored':
            fcontents = file.read_text()
            fsplit = fcontents.split('|')
            if len(fsplit) != 6:
                log.warning('process_file contains unreadable contents')
                file.rename(file.with_suffix('.ignored'))
            else:
                log.info(f'processing file {fsplit[2]}')
                cmd = ['python', f'{fsplit[0]}', f'{fsplit[1]}', f'{fsplit[2]}', f'{fsplit[3]}', f'{fsplit[4]}', f'{fsplit[5]}']
                log.debug(cmd)
                subprocess.Popen(cmd).wait()
                print(fsplit)

    sleep(1)

exit(1)
